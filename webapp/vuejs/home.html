<!DOCTYPE html>
<html>

<head>
    <title>Skin Lesion Classifier</title>
    <script src="https://cdn.jsdelivr.net/npm/vue@2.6.11"></script>
    <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
</head>

<body>
    <div id="app">
        <h3>
            This is a skin lesion classifier that uses a deep neural network trained on the HAM10000 dataset
        </h3>
        <div>

            <form enctype="multipart/form-data" novalidate>

                <h2>Select an image to upload and classify</h2>
                <div>

                    <input type="file" accept="image/*" @change="onFileChange">
                    <!-- <p v-if="isInitial || isSuccess || isFailed">
                        Drag your file(s) here to begin<br> or click to browse
                    </p>
                    <p v-if="isSaving">
                        Uploading file...
                    </p> -->
                </div>
            </form>

        </div>
        <p></p>
        <strong>
            DO NOT take the result seriously, this is just for experimenting and having fun.
        </strong>

        <div v-if="isSuccess">
            <img :src="image" />
            <h2>The most possible lesion type is: </h2>
            <p>
                Lesion type:
                {{info.lesion_type_id}}
            </p>
            <p>
                Lesion name:
                {{info.lesion_type_name}}
            </p>
        </div>

        <div v-if="isFailed">
            <h2>Upload failed!</h2>
        </div>
    </div>

    <script type="module">

        const STATUS_INITIAL = 0, STATUS_SAVING = 1, STATUS_SUCCESS = 2, STATUS_FAILED = 3;
        var app = new Vue({
            el: '#app',
            data: {
                image: '',
                info: null,
                currentStatus: STATUS_INITIAL,
            },
            computed: {
                isInitial() {
                    return this.currentStatus === STATUS_INITIAL;
                },
                isSaving() {
                    return this.currentStatus === STATUS_SAVING;
                },
                isSuccess() {
                    return this.currentStatus === STATUS_SUCCESS;
                },
                isFailed() {
                    return this.currentStatus === STATUS_FAILED;
                }
            },
            methods: {
                onFileChange(e) {
                    this.currentStatus = STATUS_SAVING;

                    var files = e.target.files || e.dataTransfer.files;
                    if (!files.length)
                        return;

                    var image = new Image();
                    var reader = new FileReader();
                    reader.onload = (e) => {
                        this.image = e.target.result;
                    };
                    reader.readAsDataURL(files[0]);

                    this.uploadImage(files[0]);
                },
                uploadImage(file) {
                    var image = new Image();
                    let formData = new FormData();
                    formData.append('file', file);

                    axios.post('/predict',
                        formData,
                        {
                            headers: { 'Content-Type': 'application/x-www-form-urlencoded' }
                        }
                    ).then(response => {
                        this.currentStatus = STATUS_SUCCESS;
                        this.info = response.data;

                    }
                    ).catch(err => {
                        this.currentStatus = STATUS_FAILED;
                    })
                }
            }
        })
    </script>

    <style>
        #app {
            text-align: center;
        }

        .box {
            background-color: white;
            outline: 2px dashed grey;
            /* the dash box */
            outline-offset: -10px;
        }

        .box__dragndrop {
            display: inline;
        }


        /* .box:hover {
            background: lightblue;
        } */

        .box.is-dragover {
            background: black;
            /* when mouse over to the drop zone, change color */
        }
    </style>
</body>

</html>